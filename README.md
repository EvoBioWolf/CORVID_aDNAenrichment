# Readme

## SNP design for myBaits and Twist

myBaits and Twist designs include 104K and 232K SNP Panels, respectively. The 232K SNP Panel includes all 104K SNPs and additional neutral SNPs. Overall, both panels include 38,498K outlier and genic SNPs for phenotypic inference, and the rest are all putativey neutral for demographic inference.

### SNP Panel 1: 104K SNP panel
Consisting of outlier, genic and neutral variants. Neutral variants were discovered from 7 individual populations (formerly referred as set6up_snp_panel). 
The 104K SNP design was submitted to AborScience to design 60bp single stranded RNA mybaits probes. 

Scripts should be run in sequence from 1.X to 4.X deposited [here](./SNP_panel_1/) to get the final panel. If only one part of the design needs to be refined, scripts can also be run separately. 

Details of the generation of otliers, genic and neutral SNPs:

1. Outliers </br>
Identification of outliers to understand how phenotypes evolved through time. Outliers identified by 99.9th perc Fst and 99.95 perc Dxy values. Fst values were generated using Christen and Verena's VCF with vcftools and ANGSD by Vijay (2016). Dxy values were generated using Christen's VCF using Simon Martin's popgenWindows.py. <br>
Requires scripts 1.X, cmplot.R & overlap_*.R to be in the same directory: `./01_probes/fst` <br>
Final output in: `./01_probes/snp_panel_1/01_outlier`

2. Genic </br>
Interesting melanogenesis genes which may not have high Fst values, but also interesting to look into. <br>
Requires script 2.1: `./01_probes/genic` <br>
`outlier_genic.R` merges outlier and genic SNPs and output to `./01_probes/snp_panel_1/02_genic` 

3. Neutral for SNP_Panel_1 </br>
Subsampling 60K snps from 14M 4fold, intronic and intergenic regions. <br>
Requires scripts 3.X: `./01_probes/neutral` and `outlier_genic_neutral.R` merges outlier, genic and neutral SNPs and output to `./01_probes/snp_panel_1/03_neutral`

4. Check </br>
Script 4.1 checks for polymorphic sites and outgroup mapping, then output to `./01_probes/snp_panel_1/04_combined` <br>
Only 121bp dummy probes mapping to New Caledonian and American crows with are retained to prevent ascertainment bias from using the hooded crow reference genome. Dummy probes with multiple hits were included giving a total of 103,771 SNPs, while 101,399 sites blast to both outgroups with single-hits. The final panel submitted to Arbor includes 103,769 SNPs (2 chrM outlier sites removed*). <br>
Assess the snp panel with `final_plot.R` and ouput to `./01_probes/snp_panel_1/05_final` <br>
Scripts 4.1, outlier_*.R, final_plot.R should be in the same directory: `./01_probes/snp_panel_1` <br>

5. Additional neutral backup SNPs generated by running scripts 3.4 and 4.2. Same approach of random subsampling, but from the pool of unselected neutral SNPs after random selection. Not needed in the end.

6. Arbor-check </br>
4 probes per site and 60-mer design for a total of 400,000 baits. A total of 254,414 neutral final baits (~97.4%) and 149,809 outlier baits (97.3%) passed the Arbor's stringent filter. Since >97% of our target sites passed the stringent filter, the back-up SNPs were not required at all. A further 4218 baits have to be removed. I kept all outlier baits and removed the excess from the neutral panel with GC at and above 73%. </br>
Final fasta bait files: `./01_probes/snp_panel_1/06_post_arbor_filter/60bp/` including `Neutral_Final_Baits_Passing_Stringent_GCFiltered.fas` and `Outlier_Baits_passing_Stringent.noNs.fas`

### SNP Panel 2: additional neutral SNPs
More neutral SNPs are included in this panel using two approaches: (i) the same as SNP Panel 1 with one extra discovery population (SNPs per discovery population) and (ii) outgroup ascertainment. Scripts are deposited [here](./SNP_panel_2/).

1. 8K neutral SNPs of the IRQ population (setadd03) using the same approach as SNP panel 1. Note that cor3 (Franch) samples are not added to avoid over-representation of the west-central populution. Path to output: `./SNP_panel_2/setadd03_biallelic_pos_nooverlap_hwe.txt`

2. 72K neutral SNPs using outgroup ascertainment approach with all 8 discovery populations. The idea of outgroup ascertainment is to avoid bias in any populations, such that only sites which are heterozygous in American crow and any populations of cor1, cnx6 and ori3 are retained. Ultimately, 72K transversion sites are retained for this panel of outgroup-ascertained SNPs Path to output: `./SNP_panel_2/neuall_outgroup_ascertained_nooverlap_final_TV_hwe.txt`.

### Twist_combined_panel: 232K SNP panel
SNP Panel 1 + SNP Panel 2 + 49K [additional neutral transversion SNPs](./Twist_combined_panel/all_neutral_backup_TV_10kbpruned_0based_final.txt).

The 232K SNP design was submitted to Twist to design 80bp double stranded DNA probes.For this Twist panel design, the allele sites are specifically chosen to be different from both REF and ALT allele to overcome ascertainment bias (see [generator](./Twist_combined_panel/probes_generator.py)). 

Ultimately both libraries captured by myBaits and Twist will be combined. The "neutral" and "outlier" SNP positions are accessible as [snp_panel_neutral_1based.pos](./snp_panel_neutral_1based.pos) and [snp_panel_outlier_1based.pos](./snp_panel_outlier_1based.pos)

---

## Performance comparison between the two designs
Pipeline to process and compare the reads from libraries enriched by myBaits and Twist is documented here as [baitcomparison.md](./baitcomparison.md)

All scripts are deposited in folder [Analyses](./Analyses)


